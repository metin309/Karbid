var karbid={renderFile:function(url,element){karbid.utils.ajax.get(url,function(data){karbid.render(data,element)})},elements:{},regions:{},binder:function(){this.BindingType={ATTRBINDING:0,LOOPBINDING:1},this.duration=50,this.bindings=[],this.interval=setInterval(()=>{for(var hebele=0,i=0;i<karbid.binder.bindings.length;i++){var binding=karbid.binder.bindings[i];binding.type==karbid.binder.BindingType.LOOPBINDING||(binding.attr.includes(".")?"style"==binding.attr.split(".")[0]&&binding.element.style[binding.attr.split(".")[1]]!=function(){return eval(binding.value)}.call(binding.element)&&(binding.element.style[binding.attr.split(".")[1]]=function(){return eval(binding.value)}.call(binding.element)):binding.element[binding.attr]!=function(){return eval(binding.value)}.call(binding.element)&&(binding.element[binding.attr]=function(){return eval(binding.value)}.call(binding.element)))}},200)},render:function(code,curelem,options){var lines=code.split("\n"),inElements=[],curElement={},pass=!1;evalScript=!1,evalScriptCode="",null==options&&(options=karbid.options.RenderOptions),this.codeBetween=function(a,b){for(var ret="",u=a;u<=b;u++)ret+=lines[u]+"\n";return ret},null!=curelem&&(inElements.push({element:curelem,parent:{},elements:[],inLoop:!1,queryElement:{}}),curElement=inElements[0]),elementsCount=100;var attribute={name:"",value:""},curAttribute="",attrValue="",curEvent="",eventCode="",bracketCount=0,inLoop=!1,loop={},binding=!1,inRegion=!1,currentRegion={},conditions=[{condition:!0}],conditionIndex=0;0==inElements.length&&(inElements.push({element:document.body,parent:{},elements:[],inLoop:!1,html:"",queryElement:{}}),curElement=inElements[0]);for(var a=0;a<lines.length;a++){var line=lines[a].trim();if(0==conditions[conditions.length-1].condition){if(!line.startsWith("endif"))continue;conditions[conditions.length-1].condition=!0}if(!pass){if(1==evalScript&&0==line.endsWith("endscript")&&(evalScriptCode+=line),line.endsWith("endregion")&&(inRegion=!1,currentRegion=""),(line.startsWith("endline")&&line.endsWith("endline")||line.startsWith("endl")&&line.endsWith("endl"))&&curElement.element.appendChild(document.createElement("br")),line.startsWith("region "))inRegion=!0,currentRegion=line.split("region ")[1],karbid.regions[currentRegion]={code:"",parent:curElement.element,render:function(){karbid.render(this.code,this.parent)}};else if(inRegion){karbid.regions[currentRegion].code+=line+"\n";continue}if(line.startsWith("include")&&line.split(" ").length>1&&karbid.utils.ajax.get(line.split(" ")[1],function(data){karbid.render(data)}),!line.startsWith("#")){if(line.startsWith("request")){var args=line.split("request ")[1].split(" "),argsObj={};if(args.length<3)console.error("Not enough arguments for request. Expected 3 got "+args.length);else{"post"!=args[0].toLowerCase()&&"get"!=args[0].toLowerCase()||(argsObj.method=args[0].toUpperCase()),argsObj.url=args[1],argsObj.url.startsWith("(")&&(argsObj.url=replaceAt(argsObj.url,argsObj.url.length-1,""),argsObj.url=replaceAt(argsObj.url,0,""),argsObj.url=eval(args[1])),argsObj.variable=args[2];var xmlHttp=new XMLHttpRequest;xmlHttp.onreadystatechange=function(){4==xmlHttp.readyState&&200==xmlHttp.status&&(window[argsObj.variable]=xmlHttp.responseText)},xmlHttp.open(argsObj.method,argsObj.url,!1),xmlHttp.send(null)}}if(line.startsWith("!")&&0==options.ignoreBindings&&""==curAttribute&&""==curEvent&&(binding=!0,line=karbid.utils.replaceAt(line,0,"")),"@"==line[0]&&""==curAttribute&&""==curEvent){line=line.replace("@",""),line.endsWith("{")&&(line=karbid.utils.replaceAt(line,line.length-1,"")),line.endsWith(":{")&&(line=karbid.utils.replaceAt(line,line.length-1,""),line=karbid.utils.replaceAt(line,line.length-1,""));var element=karbid.utils.queryConverter(line);""!=element.tag&&""!=element.tag||(element.tag="div"),""==element.id&&(element.id="elem_"+elementsCount),0==curElement.inLoop&&null!=element.loop&&(curElement.loop={},curElement.loop=element.loop,curElement.loop.startingLine=a,curElement.loop.index=0,curElement.loop.to=element.loop.to,curElement.loop.name=element.loop.name,curElement.inLoop=!0,curElement.loop.type=element.loop.type,curElement.loop.binding&&0==options.ignoreBindings&&(curElement.loop.bindingData={previousValue:JSON.stringify(eval(element.loop.varAsString)),value:element.loop.varAsString,element:curElement.element,before:curElement.element.children[curElement.element.children.length-1],type:karbid.binder.BindingType.LOOPBINDING,i:karbid.binder.bindings.length+1},karbid.binder.bindings.push(curElement.loop.bindingData)),element.loop.array.length>0?curElement.element[element.loop.name]=element.loop.array[curElement.loop.index]:curElement.element[element.loop.name]=curElement.loop.index),curElement.inLoop&&("foreach"==element.loop.type?curElement.element[element.loop.name]=element.loop.array[curElement.loop.index]:curElement.element[element.loop.name]=curElement.loop.index),htmlElement=document.createElement(element.tag),curElement.inLoop&&(htmlElement[element.loop.name]=curElement.element[element.loop.name],1==curElement.loop.binding&&htmlElement.setAttribute("karbid-bindingid",options.overrideBinding?options.overrideBinding.id:karbid.binder.bindings.length)),(null!=curElement.parent.loop||curElement.parent.parentInLoop)&&(htmlElement[curElement.parent.loop.name]=curElement.parent.element[curElement.parent.loop.name]),htmlElement.addEventListener("init",function(){if(""!=curElement.html){var text=document.createElement("text");text.innerHTML=eval(curElement.html),this.insertBefore(text,this.childNodes[curElement.htmlBefore])}}),element.attributes.forEach(function(attribute){htmlElement[attribute.name]=function(){return eval(attribute.value)}.call(htmlElement)}),(null==element.loop||"foreach"==element.loop.type&&0!=element.loop.array.length||"for"==element.loop.type&&element.loop.to-element.loop.index!=0)&&(options.insertBefore?options.insertBefore.parentElement.insertBefore(htmlElement,options.insertBefore):curElement.element.appendChild(htmlElement));var objectElement={element:htmlElement,parent:curElement,elements:[],inLoop:!1,html:""};curElement.elements.push(objectElement),curElement=objectElement,curElement.queryElement=element,elementsCount++,karbid.elements[element.id]=htmlElement,htmlElement.id=element.id,""!=element.class&&(htmlElement.className=element.class.replace("."," ")),"body"==element.tag&&(htmlElement=document.body)}if(line.endsWith("}")&&0==bracketCount&&""==curAttribute&&""==curEvent){curElement.element.dispatchEvent(init);var le=curElement;if(curElement=curElement.parent,1==curElement.inLoop)if(null==curElement.loop.endingLine&&(curElement.loop.endingLine=a,curElement.loop.binding&&0==options.ignoreBindings&&(curElement.loop.bindingData.karbidCode=this.codeBetween(curElement.loop.startingLine,curElement.loop.endingLine))),curElement.loop.index<curElement.loop.to-1)curElement.loop.index++,"foreach"==curElement.loop.type?le.element[curElement.loop.name]=curElement.loop.array[curElement.loop.index-1]:le.element[curElement.loop.name]=curElement.loop.index-1,a=curElement.loop.startingLine-1;else if(curElement.inLoop=!1,0==options.ignoreBindings||0!=Object.keys(le.parent).length){var positioner=document.createElement("k-binding-endpos");positioner.id="k-bindingID-"+karbid.binder.bindings.length,curElement.element.appendChild(positioner)}}if(""!=curAttribute)if(line.replace("\\{","").includes("{")&&bracketCount++,line.endsWith("}")||line.replace("\\}","").includes("}"))if(bracketCount>0)bracketCount--;else{if(null!=curElement.element.getAttribute(curAttribute)&&(attrValue+=curElement.element.getAttribute(curAttribute)),"style"!=curAttribute)if("stylejs"==curAttribute)for(var style=function(){return eval("({"+attrValue+"})")}.call(curElement.element),i=0;i<Object.keys(style).length;i++){var key=Object.keys(style)[i];curElement.element.style[key]=style[key]}else curElement.element.setAttribute(curAttribute,function(){return eval(attrValue)}.call(curElement.element));else curElement.element.setAttribute(curAttribute,attrValue);binding&&(karbid.binder.bindings.push({element:curElement.element,attr:curAttribute,value:attrValue}),binding=!1),curAttribute="",attrValue=""}else attrValue+=line;if(line.startsWith("attr-")&&(curAttribute=line.split("attr-")[1].split(":")[0],"{"!=line[("attr-"+curAttribute+":").length+1]&&(attrValue=line.split("attr-"+curAttribute)[1].split(":")[1],curElement.element.setAttribute(curAttribute,function(){return eval(attrValue)}.call(curElement.element)),binding&&(karbid.binder.bindings.push({element:curElement.element,attr:curAttribute,value:attrValue}),binding=!1),attrValue="",curAttribute="")),line.startsWith("html:")&&""==curAttribute&&""==curEvent&&(attrValue=line.split("html:")[1],binding&&(karbid.binder.bindings.push({element:curElement.element,attr:"innerHTML",value:attrValue}),binding=!1),attrValue=""),""!=curEvent&&(line.endsWith("}}")?(null!=curElement.element.getAttribute("on"+curEvent)?curElement.element.setAttribute("on"+curEvent,curElement.element.getAttribute("on"+curEvent)+";"+eventCode):curElement.element.addEventListener(curEvent,new Function("ev",eventCode)),curEvent="",eventCode=""):eventCode+=line),""==curEvent&&""==curAttribute){if(line.startsWith("if")&&conditions.push({code:line.split("if")[1].trim(),condition:function(){return eval(line.split("if")[1].trim())}.call(curElement.element)}),line.startsWith("elif")){var con=!eval(conditions[conditions.length-1].code);conditions.push({code:line.split("elif")[1].trim(),condition:function(){return eval(line.split("elif")[1].trim()+" && "+con)}.call(curElement.element)})}if(line.startsWith("else")){var con=function(){return eval(conditions[conditions.length-1].code)}.call(curElement.element);conditions.push({code:"",condition:!con})}if((line.startsWith('"')||line.startsWith("html"))&&(line.startsWith('"')?(line=karbid.utils.replaceAt(line,0,""),line=karbid.utils.replaceAt(line,line.length-1,""),curElement.element.innerHTML=line):(curElement.html=line.split("html")[1].substr(line.split("html")[1].indexOf(":")+1),curElement.htmlBefore=curElement.elements.length)),line.startsWith("script")&&(evalScript=!0),line.endsWith("endscript")||line.startsWith("endscript")){evalScript=!1;var sT=document.createElement("script"),sP=document.createTextNode(evalScriptCode);sT.appendChild(sP),document.body.appendChild(sT),evalScriptCode="";continue}line.startsWith("ev-")&&(curEvent=line.split("ev-")[1].split(":")[0]),line.startsWith("style:")&&(curAttribute="style"),line.startsWith("stylejs")&&(curAttribute="stylejs");for(var pdei=0;pdei<karbid.options.Predefined.Events.length;pdei++){var pde=karbid.options.Predefined.Events[pdei];if(line.startsWith(pde.karbidName+":")){curEvent=pde.eventName;break}}for(var pdattri=0;pdattri<karbid.options.Predefined.Attributes.length;pdattri++){var pdattr=karbid.options.Predefined.Attributes[pdattri];if(line.startsWith(pdattr.karbidName+":")){pdattr.attribute.split(".").length>1?curElement.element[pdattr.attribute.split(".")[0]][pdattr.attribute.split(".")[1]]=function(){return eval(line.split(pdattr.karbidName+":")[1])}.call(curElement.element):curElement.element[pdattr.attribute]=function(){return eval(line.split(pdattr.karbidName+":")[1])}.call(curElement.element),binding&&(karbid.binder.bindings.push({element:curElement.element,attr:pdattr.attribute,value:line.split(pdattr.karbidName+":")[1]}),binding=!1);break}}}}}}},utils:{of:function(query,all){var elem;return elem=null!=all&&1==all?document.querySelectorAll(query):document.querySelector(query)},replaceAt:function(string,index,replace){return string.substring(0,index)+replace+string.substring(index+1)},findElement:function(elements,element){for(var a=0;a<elements.length;a++)if(elements[a]==element)return elements[a]},queryConverter:function(query){var element={id:"",tag:"",class:"",attributes:[]};if(query.includes(":")&&query.includes("(")&&query.includes(")")){var name=query.split(":")[0].split("(")[1],to=eval(karbid.utils.replaceAt(query.substr(query.indexOf(":")+1),query.substr(query.indexOf(":")+1).length-1,"")),array=new Array,type="";to.constructor===Array?(array=to,to=array.length,type="foreach"):type="for",element.loop={type:type,name:name,to:to,array:array,index:0,binding:query.split("(")[0].endsWith("!"),varAsString:karbid.utils.replaceAt(query.substr(query.indexOf(":")+1),query.substr(query.indexOf(":")+1).length-1,"")},query=query.split(":")[0].split(element.loop.binding?"!":"(")[0]}var splitter="";curAttr={name:"",value:""};for(var i=0;i<query.length&&("="!=splitter&&"["!=splitter&&("#"==query[i]&&(splitter="#"),"."==query[i]&&(splitter=".")),"["==query[i]&&(query=karbid.utils.replaceAt(query,i,""),splitter="[",element.attributes.push({name:"",value:""})),"="==query[i]&&(query=karbid.utils.replaceAt(query,i,""),splitter="="),"]"==query[i]&&(splitter="]"),","==query[i]&&(splitter=",",element.attributes.push({name:"",value:""})),"{"!=query[i]);i++)""==splitter&&(element.tag+=query[i]),"."==splitter&&(element.class+=query[i].replace("."," ")),"#"==splitter&&(element.id+=query[i].replace("#","")),"["==splitter&&(element.attributes[element.attributes.length-1].name+=query[i]),"="==splitter&&(element.attributes[element.attributes.length-1].value+=query[i]),"]"!=splitter&&","!=splitter||","==splitter&&(splitter="[");return element.class=karbid.utils.replaceAt(element.class,0,""),element},ajax:{get:function(theUrl,callback){var xmlHttp=new XMLHttpRequest;xmlHttp.onreadystatechange=function(){4==xmlHttp.readyState&&200==xmlHttp.status&&callback(xmlHttp.responseText)},xmlHttp.open("GET",theUrl,!1),xmlHttp.send(null)},post:function(theUrl,callback){var xmlHttp=new XMLHttpRequest;xmlHttp.onreadystatechange=function(){4==xmlHttp.readyState&&200==xmlHttp.status&&callback(xmlHttp.responseText)},xmlHttp.open("POST",theUrl,!1),xmlHttp.send(null)}}},options:{Predefined:{Events:[{karbidName:"click",eventName:"click"},{karbidName:"input",eventName:"input"}],Attributes:[{karbidName:"border",attribute:"style.border"},{karbidName:"width",attribute:"style.width"},{karbidName:"height",attribute:"style.height"},{karbidName:"padding",attribute:"style.padding"},{karbidName:"margin",attribute:"style.margin"},{karbidName:"color",attribute:"style.color"},{karbidName:"backgroundColor",attribute:"style.backgroundColor"},{karbidName:"display",attribute:"style.display"},{karbidName:"fontSize",attribute:"style.fontSize"},{karbidName:"border",attribute:"style.border"},{karbidName:"value",attribute:"value"},{karbidName:"val",attribute:"value"},{karbidName:"placeholder",attribute:"placeholder"},{karbidName:"type",attribute:"type"}]},RenderOptions:{ignoreBindings:!1}}},init=new Event("init");karbid.binder=new karbid.binder;